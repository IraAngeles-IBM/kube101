
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Scale and update apps natively Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="README_2.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../k8s.html">
            
                <a href="../k8s.html">
            
                    
                    What is Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Lab 0: Pre-requisite
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Lab0/">
            
                <a href="../Lab0/">
            
                    
                    Get the IBM Cloud Container Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../pre-work/CREATE_IBMID.html">
            
                <a href="../pre-work/CREATE_IBMID.html">
            
                    
                    Create an IBM Cloud account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../pre-work/ACCESS_CLUSTER.html">
            
                <a href="../pre-work/ACCESS_CLUSTER.html">
            
                    
                    Access Kubernetes cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../pre-work/CLOUD_SHELL.html">
            
                <a href="../pre-work/CLOUD_SHELL.html">
            
                    
                    Accessing the IBM Cloud Shell
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Labs</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../Lab1/">
            
                <a href="../Lab1/">
            
                    
                    Lab 1. Set up and deploy your first application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../Lab2/">
            
                <a href="../Lab2/">
            
                    
                    Lab 2: Scale and Update Deployments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <span>
            
                    
                    Lab 3: Scale and update apps natively, building multi-tier applications
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.3.1" data-path="README_1.html">
            
                <a href="README_1.html">
            
                    
                    Scale and update apps natively
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="README_2.html">
            
                <a href="README_2.html">
            
                    
                    Connect to a back-end service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../LabD/">
            
                <a href="../LabD/">
            
                    
                    Lab D: Troubleshooting and Debugging
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Resources</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://cognitiveclass.ai/courses/kubernetes-course">
            
                    
                    Introduction to Containers, Kubernetes, and OpenShift
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <a target="_blank" href="https://cognitiveclass.ai/courses/docker-essentials">
            
                    
                    Badge: Docker Essentials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <a target="_blank" href="https://developer.ibm.com/components/kubernetes/">
            
                    
                    Kubernetes @ IBM Developer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <a target="_blank" href="https://www.ibm.com/account/reg/us-en/signup?formid=urx-34925&cm_mmc=OSocial_Twitter-_-Developer_Innovation-_-WW_WW-_-Kubernetes+in+the+Enterprise+Ebook_ov67299&cm_mmca1=000019RS&cm_mmca2=10004796">
            
                    
                    O'Reilly ebook: Kubernetes in the Enterprise
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" >
            
                <a target="_blank" href="https://developer.ibm.com">
            
                    
                    IBM Developer
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Scale and update apps natively</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="lab-3-scale-and-update-apps-natively-building-multi-tier-applications">Lab 3: Scale and update apps natively, building multi-tier applications.</h1>
<p>In this lab you&apos;ll learn how to deploy the same guestbook application we
deployed in the previous labs, however, instead of using the <code>kubectl</code>
command line helper functions we&apos;ll be deploying the application using
configuration files. The configuration file mechanism allows you to have more
fine-grained control over all of resources being created within the
Kubernetes cluster.</p>
<p>Before we work with the application we need to clone a github repo:</p>
<pre><code class="lang-shell">git clone https://github.com/IBM/guestbook.git
</code></pre>
<p>This repo contains multiple versions of the guestbook application
as well as the configuration files we&apos;ll use to deploy the pieces of the application.</p>
<p>Change directory by running the command </p>
<pre><code class="lang-shell">cd guestbook/v1
</code></pre>
<p>You will find all the
configurations files for this exercise in this directory.</p>
<h2 id="1-scale-apps-natively">1. Scale apps natively</h2>
<p>Kubernetes can deploy an individual pod to run an application but when you
need to scale it to handle a large number of requests a <code>Deployment</code> is the
resource you want to use.
A Deployment manages a collection of similar pods. When you ask for a specific number of replicas
the Kubernetes Deployment Controller will attempt to maintain that number of replicas at all times.</p>
<p>Every Kubernetes object we create should provide two nested object fields
that govern the object&#x2019;s configuration: the object <code>spec</code> and the object
<code>status</code>. Object <code>spec</code> defines the desired state, and object <code>status</code>
contains Kubernetes system provided information about the actual state of the
resource. As described before, Kubernetes will attempt to reconcile
your desired state with the actual state of the system.</p>
<p>For Object that we create we need to provide the <code>apiVersion</code> you are using
to create the object, <code>kind</code> of the object we are creating and the <code>metadata</code>
about the object such as a <code>name</code>, set of <code>labels</code> and optionally <code>namespace</code>
that this object should belong.</p>
<p>Consider the following deployment configuration for guestbook application</p>
<p><strong>guestbook-deployment.yaml</strong></p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> apps/v1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> guestbook-v1
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> guestbook
<span class="hljs-attr">    version:</span> <span class="hljs-string">&quot;1.0&quot;</span>
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> guestbook
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> guestbook
<span class="hljs-attr">        version:</span> <span class="hljs-string">&quot;1.0&quot;</span>
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> guestbook
<span class="hljs-attr">        image:</span> ibmcom/guestbook:v1
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - name:</span> http-server
<span class="hljs-attr">          containerPort:</span> <span class="hljs-number">3000</span>
</code></pre>
<p>The above configuration file create a deployment object named &apos;guestbook&apos;
with a pod containing a single container running the image
<code>ibmcom/guestbook:v1</code>.  Also the configuration specifies replicas set to 3
and Kubernetes tries to make sure that at least three active pods are running at
all times.</p>
<ul>
<li><p>Create guestbook deployment</p>
<p> To create a Deployment using this configuration file we use the
 following command:</p>
<pre><code class="lang-shell"> kubectl create -f guestbook-deployment.yaml
</code></pre>
</li>
<li><p>List the pod with label app=guestbook</p>
<p>We can then list the pods it created by listing all pods that
have a label of &quot;app&quot; with a value of &quot;guestbook&quot;. This matches
the labels defined above in the yaml file in the
<code>spec.template.metadata.labels</code> section.</p>
<pre><code class="lang-shell"> kubectl get pods -l app=guestbook
</code></pre>
</li>
</ul>
<p>When you change the number of replicas in the configuration, Kubernetes will
try to add, or remove, pods from the system to match your request. To can
make these modifications by using the following command:</p>
<pre><code class="lang-shell">   kubectl edit deployment guestbook-v1
</code></pre>
<p>This will retrieve the latest configuration for the Deployment from the
Kubernetes server and then load it into an editor for you. You&apos;ll notice
that there are a lot more fields in this version than the original yaml
file we used. This is because it contains all of the properties about the
Deployment that Kubernetes knows about, not just the ones we chose to
specify when we create it. Also notice that it now contains the <code>status</code>
section mentioned previously.</p>
<p>To exit the <code>vi</code> editor, type <code>:q!</code>, of if you made changes that you want to see reflected, save them using <code>:wq</code>.</p>
<p>You can also edit the deployment file we used to create the Deployment
to make changes. You should use the following command to make the change
effective when you edit the deployment locally.</p>
<pre><code class="lang-shell">   kubectl apply -f guestbook-deployment.yaml
</code></pre>
<p>This will ask Kubernetes to &quot;diff&quot; our yaml file with the current state
of the Deployment and apply just those changes.</p>
<p>We can now define a Service object to expose the deployment to external
clients.</p>
<p><strong>guestbook-service.yaml</strong></p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> guestbook
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> guestbook
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - port:</span> <span class="hljs-number">3000</span>
<span class="hljs-attr">    targetPort:</span> http-server
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> guestbook
<span class="hljs-attr">  type:</span> LoadBalancer
</code></pre>
<p>The above configuration creates a Service resource named guestbook. A Service
can be used to create a network path for incoming traffic to your running
application.  In this case, we are setting up a route from port 3000 on the
cluster to the &quot;http-server&quot; port on our app, which is port 3000 per the
Deployment container spec.</p>
<ul>
<li><p>Let us now create the guestbook service using the same type of command
we used when we created the Deployment:</p>
<pre><code class="lang-shell">kubectl create -f guestbook-service.yaml
</code></pre>
</li>
<li><p>Test guestbook app using a browser of your choice using the url
<code>&lt;your-cluster-ip&gt;:&lt;node-port&gt;</code></p>
<p>Remember, to get the <code>nodeport</code> and <code>public-ip</code> use the following commands, replacing <code>$CLUSTER_NAME</code> with the name of your cluster if the environment variable is not already set.</p>
<pre><code class="lang-shell">kubectl describe service guestbook
</code></pre>
<p>and</p>
<pre><code class="lang-shell">ibmcloud ks workers --cluster $CLUSTER_NAME
</code></pre>
</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="README_2.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Connect to a back-end service">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Scale and update apps natively","level":"2.3.1","depth":2,"next":{"title":"Connect to a back-end service","level":"2.3.2","depth":2,"path":"Lab3/README_2.md","ref":"Lab3/README_2.md","articles":[]},"previous":{"title":"Lab 3: Scale and update apps natively, building multi-tier applications","level":"2.3","depth":1,"ref":"","articles":[{"title":"Scale and update apps natively","level":"2.3.1","depth":2,"path":"Lab3/README_1.md","ref":"Lab3/README_1.md","articles":[]},{"title":"Connect to a back-end service","level":"2.3.2","depth":2,"path":"Lab3/README_2.md","ref":"Lab3/README_2.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":[],"root":"./workshop","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"Lab3/README_1.md","mtime":"2020-08-10T08:32:52.599Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-11T06:23:04.492Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

